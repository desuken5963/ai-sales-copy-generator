# ---- Build Stage ----
FROM golang:1.22-alpine AS builder

WORKDIR /app

# 依存関係のキャッシュ
COPY go.mod go.sum ./
RUN go mod download

# ソースコードをコピー
COPY . .

# Lambda用バイナリをビルド
RUN CGO_ENABLED=0 GOOS=linux GOARCH=amd64 go build -o bootstrap ./cmd/api

# ---- Run Stage (Lambda base image) ----
FROM public.ecr.aws/lambda/go:1

# ビルドしたバイナリをLambdaのエントリポイントとしてコピー
COPY --from=builder /app/bootstrap ${LAMBDA_RUNTIME_DIR}

# Lambda起動時に実行されるコマンド（省略可、デフォルトでbootstrapが呼ばれる）
# CMD ["bootstrap"] 